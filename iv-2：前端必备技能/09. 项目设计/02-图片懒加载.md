# 图片懒加载

## 题目

设计一个 H5 页面的图片懒加载功能

## 要点

第一，`<img>` 要使用 `data-src`（或其他属性）记录 src 。还有，loading.gif 要自定义，要配合实际图片的尺寸。

```html
<img src="./img/loading.gif" data-src="./img/animal1.jpeg"/>
```

第二，可以使用 `Element.getBoundingClientRect()` 来判断当前元素的位置

![](./img/rect.png)

第三，页面滚动实时计算，将 data-src 赋值给 src

第四，注意，滚动要**节流**

## 实现

代码参考 img-lazy-load.html

```js
function mapImagesAndTryLoad() {
    const images = document.querySelectorAll('img[data-src]')
    if (images.length === 0) return

    images.forEach(img => {
        const rect = img.getBoundingClientRect()
        if (rect.top < window.innerHeight) {
            // 漏出来
            // console.info('loading img', img.dataset.src)
            img.src = img.dataset.src
            img.removeAttribute('data-src') // 移除 data-src 属性，为了下次执行时减少计算成本
        }
    })
}

window.addEventListener('scroll', _.throttle(() => {
    mapImagesAndTryLoad()
}, 100))

mapImagesAndTryLoad()
```

## 划重点

滚动节流，注意操作体验
